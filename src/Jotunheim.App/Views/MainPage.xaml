<?xml version="1.0" encoding="UTF-8" ?>
<Page
    x:Class="Jotunheim.App.Views.MainPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="using:Jotunheim.App.Models"
    xmlns:controls="using:Microsoft.UI.Xaml.Controls"
    mc:Ignorable="d">
    <Page.Transitions>
        <TransitionCollection>
            <EntranceThemeTransition />
        </TransitionCollection>
    </Page.Transitions>

    <Grid>
        <Grid.Background>
            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                <GradientStop Color="#070B14" Offset="0" />
                <GradientStop Color="#0D1426" Offset="0.45" />
                <GradientStop Color="#101B31" Offset="1" />
            </LinearGradientBrush>
        </Grid.Background>

        <Grid IsHitTestVisible="False">
            <Canvas>
                <Ellipse Width="2" Height="2" Fill="#66FFFFFF" Canvas.Left="34" Canvas.Top="42" />
                <Ellipse Width="1.5" Height="1.5" Fill="#55FFFFFF" Canvas.Left="220" Canvas.Top="90" />
                <Ellipse Width="2" Height="2" Fill="#55FFFFFF" Canvas.Left="480" Canvas.Top="40" />
                <Ellipse Width="1.5" Height="1.5" Fill="#44FFFFFF" Canvas.Left="620" Canvas.Top="120" />
                <Ellipse Width="2" Height="2" Fill="#66FFFFFF" Canvas.Left="860" Canvas.Top="60" />
                <Ellipse Width="1.5" Height="1.5" Fill="#44FFFFFF" Canvas.Left="980" Canvas.Top="150" />
                <Ellipse Width="2" Height="2" Fill="#55FFFFFF" Canvas.Left="120" Canvas.Top="260" />
                <Ellipse Width="1.5" Height="1.5" Fill="#55FFFFFF" Canvas.Left="360" Canvas.Top="210" />
                <Ellipse Width="2" Height="2" Fill="#66FFFFFF" Canvas.Left="520" Canvas.Top="280" />
                <Ellipse Width="1.5" Height="1.5" Fill="#44FFFFFF" Canvas.Left="740" Canvas.Top="240" />
                <Ellipse Width="2" Height="2" Fill="#55FFFFFF" Canvas.Left="960" Canvas.Top="260" />
                <Ellipse Width="1.5" Height="1.5" Fill="#44FFFFFF" Canvas.Left="1100" Canvas.Top="200" />
            </Canvas>
            <Ellipse
                Width="420"
                Height="420"
                HorizontalAlignment="Left"
                VerticalAlignment="Top"
                Margin="-120,-140,0,0">
                <Ellipse.Fill>
                    <RadialGradientBrush>
                        <GradientStop Color="#202C47" Offset="0" />
                        <GradientStop Color="#00FFFFFF" Offset="1" />
                    </RadialGradientBrush>
                </Ellipse.Fill>
            </Ellipse>
            <Ellipse
                Width="300"
                Height="300"
                HorizontalAlignment="Right"
                VerticalAlignment="Bottom"
                Margin="0,0,-80,-120">
                <Ellipse.Fill>
                    <RadialGradientBrush>
                        <GradientStop Color="#2D1F3A" Offset="0" />
                        <GradientStop Color="#00FFFFFF" Offset="1" />
                    </RadialGradientBrush>
                </Ellipse.Fill>
            </Ellipse>
        </Grid>

        <Grid Margin="24" ColumnSpacing="24">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="360" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <ScrollViewer
                Grid.Column="0"
                VerticalScrollBarVisibility="Auto">
                <StackPanel Spacing="16" Padding="0,0,8,0">
                    <Border Style="{StaticResource CardStyle}">
                        <StackPanel Spacing="6">
                            <TextBlock FontSize="28" FontWeight="SemiBold" Text="Jotunheim" />
                            <TextBlock Style="{StaticResource Caption}" Text="Orbital tracking console • SGP4 live propagation" />
                            <TextBlock Style="{StaticResource Caption}" Text="Local propagation powered by SGP4Prop.dll" />
                        </StackPanel>
                    </Border>

                    <Border Style="{StaticResource CardStyle}">
                        <StackPanel Spacing="12">
                            <TextBlock Style="{StaticResource SectionHeader}" Text="Space-Track" />
                            <TextBox
                                x:Name="SpaceTrackUserTextBox"
                                Header="Username"
                                PlaceholderText="you@domain.com" />
                            <PasswordBox x:Name="SpaceTrackPasswordBox" Header="Password" />
                            <ToggleSwitch
                                x:Name="RememberCredentialsToggle"
                                Header="Remember credentials"
                                OffContent="Not saved"
                                OnContent="Saved securely"
                                Toggled="OnRememberCredentialsToggled" />
                            <Button
                                Click="OnForgetCredentials"
                                Content="Forget saved credentials"
                                Style="{StaticResource GhostButton}" />
                            <TextBox
                                x:Name="SpaceTrackNoradTextBox"
                                Header="NORAD IDs"
                                PlaceholderText="25544, 33591" />
                            <Button
                                Click="OnFetchFromSpaceTrack"
                                Content="Fetch Latest TLEs"
                                Style="{StaticResource PrimaryButton}" />
                            <StackPanel Orientation="Horizontal" Spacing="10">
                                <controls:ProgressRing
                                    Height="20"
                                    IsActive="{x:Bind IsBusy, Mode=OneWay}"
                                    Width="20" />
                                <TextBlock Style="{StaticResource Caption}" Text="{x:Bind BusyLabel, Mode=OneWay}" />
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <Border Style="{StaticResource CardStyle}">
                        <StackPanel Spacing="10">
                            <TextBlock Style="{StaticResource SectionHeader}" Text="Ground Station" />
                            <ComboBox
                                x:Name="StationSelector"
                                DisplayMemberPath="Name"
                                ItemsSource="{x:Bind Stations}"
                                PlaceholderText="No stations saved"
                                SelectedItem="{x:Bind SelectedStation, Mode=TwoWay}" />
                            <TextBlock Style="{StaticResource Caption}" Text="{x:Bind GroundStationSummary, Mode=OneWay}" />
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <Button
                                    Click="OnAddOrEditStation"
                                    Content="Add / Edit"
                                    Style="{StaticResource GhostButton}" />
                                <Button
                                    Click="OnRemoveStation"
                                    Content="Remove"
                                    Style="{StaticResource GhostButton}" />
                            </StackPanel>
                            <ToggleSwitch
                                x:Name="UtmToggle"
                                Header="Coordinate Mode"
                                OffContent="Local ENU"
                                OnContent="UTM (global)"
                                Toggled="OnCoordinateModeToggled" />
                            <TextBlock Style="{StaticResource Caption}" Text="{x:Bind CoordModeLabel, Mode=OneWay}" />
                        </StackPanel>
                    </Border>

                    <Border Style="{StaticResource CardStyle}">
                        <StackPanel Spacing="12">
                            <TextBlock Style="{StaticResource SectionHeader}" Text="Paste TLE" />
                            <TextBox
                                x:Name="TleInputTextBox"
                                AcceptsReturn="True"
                                Height="160"
                                PlaceholderText="Paste 2-line or 3-line TLEs here."
                                TextWrapping="Wrap" />
                            <StackPanel Orientation="Horizontal" Spacing="12">
                                <Button
                                    Click="OnImportTles"
                                    Content="Import TLEs"
                                    Style="{StaticResource GhostButton}" />
                                <Button
                                    Click="OnPickTleFile"
                                    Content="Pick TLE File"
                                    Style="{StaticResource GhostButton}" />
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <Border Style="{StaticResource CardStyle}">
                        <StackPanel Spacing="10">
                            <TextBlock Style="{StaticResource SectionHeader}" Text="Debug Log" />
                            <TextBox
                                x:Name="DebugLogTextBox"
                                IsReadOnly="True"
                                AcceptsReturn="True"
                                Height="140"
                                TextWrapping="Wrap"
                                Text="{x:Bind DebugLogText, Mode=OneWay}" />
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <Button
                                    Click="OnRefreshLog"
                                    Content="Refresh"
                                    Style="{StaticResource GhostButton}" />
                                <Button
                                    Click="OnOpenLog"
                                    Content="Open Log"
                                    Style="{StaticResource GhostButton}" />
                                <Button
                                    Click="OnClearLog"
                                    Content="Clear Log"
                                    Style="{StaticResource GhostButton}" />
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <controls:InfoBar
                        x:Name="StatusBar"
                        IsOpen="{x:Bind IsStatusOpen, Mode=OneWay}"
                        Message="{x:Bind StatusMessage, Mode=OneWay}"
                        Severity="{x:Bind StatusSeverity, Mode=OneWay}" />
                </StackPanel>
            </ScrollViewer>

            <Grid Grid.Column="1" RowSpacing="16">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <Border Style="{StaticResource CardStyle}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <StackPanel Spacing="4">
                            <TextBlock Style="{StaticResource SectionHeader}" Text="Satellites" />
                            <TextBlock Style="{StaticResource Caption}" Text="Select one to stream live position." />
                        </StackPanel>
                        <Button
                            Grid.Column="1"
                            Click="OnClearSatellites"
                            Content="Clear"
                            Style="{StaticResource GhostButton}" />
                    </Grid>
                </Border>

                <Grid Grid.Row="1" RowSpacing="16">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <Border Grid.Row="0" Style="{StaticResource CardStyle}">
                        <Grid ColumnSpacing="16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="2*" />
                                <ColumnDefinition Width="3*" />
                            </Grid.ColumnDefinitions>

                            <ListView
                                x:Name="SatelliteListView"
                                MaxHeight="220"
                                ItemsSource="{x:Bind Satellites}"
                                SelectedItem="{x:Bind SelectedSatellite, Mode=TwoWay}">
                                <ListView.ItemTemplate>
                                    <DataTemplate x:DataType="models:SatelliteInfo">
                                        <StackPanel Padding="8" Spacing="2">
                                            <TextBlock FontWeight="SemiBold" Text="{x:Bind Name}" />
                                            <TextBlock Style="{StaticResource Caption}" Text="{x:Bind DisplayId}" />
                                        </StackPanel>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>

                            <StackPanel Grid.Column="1" Spacing="12">
                                <TextBlock FontSize="22" FontWeight="SemiBold" Text="{x:Bind SelectedName, Mode=OneWay}" />
                                <TextBlock Style="{StaticResource Caption}" Text="{x:Bind SelectedMeta, Mode=OneWay}" />
                                <ToggleSwitch
                                    x:Name="LatLonToggle"
                                    Header="Display"
                                    OffContent="Easting/Northing"
                                    OnContent="Lat/Lon"
                                    IsOn="{x:Bind ShowLatLon, Mode=TwoWay}" />

                                <Grid ColumnSpacing="16" RowSpacing="12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>

                                    <StackPanel Grid.Row="0" Grid.Column="0" Spacing="2">
                                        <TextBlock Style="{StaticResource Caption}" Text="{x:Bind CoordLabel1, Mode=OneWay}" />
                                        <TextBlock FontFamily="{StaticResource DataFont}" Text="{x:Bind EastingText, Mode=OneWay}" />
                                    </StackPanel>
                                    <StackPanel Grid.Row="0" Grid.Column="1" Spacing="2">
                                        <TextBlock Style="{StaticResource Caption}" Text="{x:Bind CoordLabel2, Mode=OneWay}" />
                                        <TextBlock FontFamily="{StaticResource DataFont}" Text="{x:Bind NorthingText, Mode=OneWay}" />
                                    </StackPanel>
                                    <StackPanel Grid.Row="1" Grid.Column="0" Spacing="2">
                                        <TextBlock Style="{StaticResource Caption}" Text="{x:Bind CoordLabel3, Mode=OneWay}" />
                                        <TextBlock FontFamily="{StaticResource DataFont}" Text="{x:Bind UpText, Mode=OneWay}" />
                                    </StackPanel>
                                    <StackPanel Grid.Row="1" Grid.Column="1" Spacing="2">
                                        <TextBlock Style="{StaticResource Caption}" Text="Speed" />
                                        <TextBlock FontFamily="{StaticResource DataFont}" Text="{x:Bind SpeedText, Mode=OneWay}" />
                                    </StackPanel>
                                    <StackPanel Grid.Row="2" Grid.Column="0" Spacing="2">
                                        <TextBlock Style="{StaticResource Caption}" Text="ECI Position (km)" />
                                        <TextBlock FontSize="12" FontFamily="{StaticResource DataFont}" Text="{x:Bind PositionText, Mode=OneWay}" />
                                    </StackPanel>
                                    <StackPanel Grid.Row="2" Grid.Column="1" Spacing="2">
                                        <TextBlock Style="{StaticResource Caption}" Text="ECI Velocity (km/s)" />
                                        <TextBlock FontSize="12" FontFamily="{StaticResource DataFont}" Text="{x:Bind VelocityText, Mode=OneWay}" />
                                    </StackPanel>
                                </Grid>

                                <TextBlock Style="{StaticResource Caption}" Text="{x:Bind LastUpdatedText, Mode=OneWay}" />
                            </StackPanel>
                        </Grid>
                    </Border>

                    <Border Grid.Row="1" Style="{StaticResource CardStyle}">
                        <Grid RowSpacing="12">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>
                            <TextBlock Style="{StaticResource SectionHeader}" Text="Map View" />
                            <StackPanel Grid.Row="1" Orientation="Horizontal" Spacing="16">
                                <ToggleSwitch
                                    x:Name="TrackToggle"
                                    Header="Path"
                                    OffContent="Hidden"
                                    OnContent="Shown"
                                    IsOn="{x:Bind ShowTrack, Mode=TwoWay}" />
                                <ToggleSwitch
                                    x:Name="FutureToggle"
                                    Header="Future"
                                    OffContent="Off"
                                    OnContent="On"
                                    IsEnabled="{x:Bind ShowTrack, Mode=OneWay}"
                                    IsOn="{x:Bind ShowFutureTrack, Mode=TwoWay}" />
                            </StackPanel>
                            <controls:WebView2
                                x:Name="MapView"
                                Grid.Row="2"
                                DefaultBackgroundColor="#FF0E1627" />
                        </Grid>
                    </Border>
                </Grid>
            </Grid>
        </Grid>
    </Grid>
</Page>
